{% extends "pageframe.html" %}

{% block page %}
{% if data.map_html %}
<h2 id="title">Adventure Map</h2>
<div id="map">
    {{ data.map_html|raw }}
</div>
{% if data.options.desktop %}
<script>
    let hsMap = document.querySelector("table[width='500']");
    if (hsMap)
        hsMap.removeAttribute("width");
</script>
{% else %}
{% set mapWidth = (data.s == "6") ? 835 : 610 %}
{% set mapHeight = (data.s == "6") ? 12019 : 2444 %}
<script>
    function fixMap()
    {
        const page = document.getElementById("page");
        const map = document.getElementById("map");
        const MAP_WIDTH = {{ mapWidth }};
        const MAP_HEIGHT = {{ mapHeight }};

        if (map.children[0].getAttribute("width") == "500")
        {
            map.children[0].setAttribute("width", "835");
        }
        if (MAP_WIDTH <= page.clientWidth)
        {
            map.style.transform = null;
            map.style.transformOrigin = null;
            map.style.height = null;
            return;
        }

        let ratio = page.clientWidth / map.children[0].clientWidth;
        map.style.transform = `scale(${ratio})`;
        map.style.transformOrigin = "top left";
        map.style.height = `${MAP_HEIGHT * ratio + 30}px`;
    }

    window.addEventListener("resize", fixMap);
    fixMap();
</script>
<style>
    /* Force the PS map to its actual size. This makes it use the above JS to fix its size.
    HTML maps aren't responsive! */
    img[src="/mspa/maps/map_04.gif"] {
        min-width: 610px;
    }
</style>
{% endif %}
{% else %}
<h2 id="title">Select Map</h2>
<div id="content">
    <div class="adventure-list">
        {% for adv in data.adventures %}
        {% if not adv.hidden and has_adventure(adv.id) %}
        <a href="/map/{{ adv.id }}">{{ adv.title }}</a>
        {% endif %}
        {% endfor %}
    </div>
</div>
{% endif %}
{% endblock %}